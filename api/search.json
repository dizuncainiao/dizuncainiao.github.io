[{"id":"53f040a798a170ca18dea5684f0540a9","title":"TypeScript infer","content":"å‰è¨€TypeScript æ˜¯å¾®è½¯å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„ç¼–ç¨‹è¯­è¨€ï¼Œé€šè¿‡åœ¨ JavaScript çš„åŸºç¡€ä¸Šæ·»åŠ é™æ€ç±»å‹å®šä¹‰æ„å»ºè€Œæˆã€‚å®ƒæ˜¯ JavaScript çš„è¶…é›†ï¼Œä¸ä»…æ”¯æŒåŸç”ŸJSçš„å†™æ³•ï¼Œè¿˜å¢åŠ äº†å¾ˆå¤šæœ‰ç”¨ã€å¼ºå¤§çš„åŠŸèƒ½ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œ JavaScript æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œä¸€äº›å¾ˆä½çº§å´éš¾ä»¥å‘ç°çš„ Bug åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°ï¼Œè€Œ TypeScript å´èƒ½å¤Ÿåœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­å°±èƒ½é¿å…ç»å¤§éƒ¨åˆ†çš„ä½çº§æŠ¥é”™ã€‚æœ¬ä¸“æ ç”¨äºè®°å½•å’Œåˆ†äº«æˆ‘åœ¨ä½¿ç”¨ TypeScript ä¸­çš„æ„Ÿæ‚Ÿå’Œå¿ƒå¾—ï¼Œä»¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹ infer çš„ç”¨æ³•ï¼š\ninfer å…³é”®å­—\n\n\n\n\n\n\n\n\nåœ¨æœ‰æ¡ä»¶ç±»å‹çš„ extends å­è¯­å¥ä¸­ï¼Œå…è®¸å‡ºç° infer å£°æ˜ï¼Œå®ƒä¼šå¼•å…¥ä¸€ä¸ªå¾…æ¨æ–­çš„ç±»å‹å˜é‡ã€‚ è¿™ä¸ªæ¨æ–­çš„ç±»å‹å˜é‡å¯ä»¥åœ¨æœ‰æ¡ä»¶ç±»å‹çš„ true åˆ†æ”¯ä¸­è¢«å¼•ç”¨ã€‚\nè¿™å°±æ˜¯ infer çš„è§£é‡Šï¼Œæ˜¯ä¸æ˜¯ä¸Šæ¥ä¸€çœ‹å°±æœ‰ç‚¹æ‡µã€‚æ™¦æ¶©çš„æè¿°ä»å­—é¢æ„æ€æ¥çœ‹ç¡®å®å¾ˆéš¾æ‡‚ï¼Œé€šè¿‡åˆ†è§£çŸ¥è¯†ç‚¹ä»¥åŠç»“åˆä¸€äº›ä¾‹å­åå°±å¾ˆå¥½ç†è§£äº†ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ¡ä»¶ç±»å‹ï¼š\næ¡ä»¶ç±»å‹åƒè¿™æ · T extends U ? X : Y çš„è¡¨è¾¾å¼å°±æ˜¯æ¡ä»¶ç±»å‹ï¼Œç»“åˆä»¥ä¸‹ä»£ç ï¼š\ntype ConditionType&lt;T&gt; &#x3D; T extends Boolean ? number : undefined\n\nconst a: boolean &#x3D; false\nconst b: string &#x3D; &#39;false&#39;\n\ntype TypeA &#x3D; typeof a &#x2F;&#x2F; boolean\ntype TypeB &#x3D; typeof b &#x2F;&#x2F; string\n\ntype T1 &#x3D; ConditionType&lt;TypeA&gt; &#x2F;&#x2F; number\ntype T2 &#x3D; ConditionType&lt;TypeB&gt; &#x2F;&#x2F; undefined\n\nConditionType æ˜¯æˆ‘å®šä¹‰çš„ä¸€ä¸ªç®€å•çš„å·¥å…·ç±»å‹ï¼Œå®ƒå¯ä»¥æ¥æ”¶ä¸€ä¸ª æ³›å‹å‚æ•° Tï¼Œå¹¶åˆ†åˆ«è¿”å›ä¸åŒçš„ç±»å‹ã€‚ä»¥ä¸Šç¬¬ä¸€è¡Œä»£ç å¯ä»¥ç†è§£ä¸ºï¼šå¦‚æœ T æ˜¯å¸ƒå°”ç±»å‹åˆ™è¿”å› number ç±»å‹ï¼Œä¸æ˜¯åˆ™è¿”å› undefined ç±»å‹ã€‚ç”šè‡³ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çº¦æŸä¼ å…¥çš„ æ³›å‹å‚æ•° T çš„ç±»å‹ï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´ä¸¥è°¨ä¸€ç‚¹ï¼Œå¦‚ä¸‹ï¼š\ntype Types &#x3D; boolean | string\ntype ConditionType&lt;T extends Types&gt; &#x3D; T extends Boolean ? number : undefined\n\ntype TypeC &#x3D; object\ntype T3 &#x3D; ConditionType&lt;TypeC&gt; &#x2F;&#x2F; Error: Type &#39;object&#39; does not satisfy the constraint &#39;Types&#39;. \n\né€šè¿‡å¯¹æ³›å‹å‚æ•°ç±»å‹çš„çº¦æŸï¼Œä¼ å…¥å…¶ä»–ç±»å‹ä¼šæŠ¥é”™ã€‚\nReturnTypeï¼ˆè·å–å‡½æ•°è¿”å›å€¼ç±»å‹ï¼‰ç»“åˆ Typescript å†…ç½®å·¥å…·ç±»å‹ ReturnType æ¥ç†è§£ â€œä½¿ç”¨ infer å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªå¾…æ¨æ–­çš„ç±»å‹å˜é‡â€ã€‚ReturnType å¯ä»¥è·å–å‡½æ•°è¿”å›å€¼ç±»å‹ï¼Œå®ƒçš„æ ¸å¿ƒä¹Ÿæ˜¯ infer æ¥å®ç°çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š\n&#x2F;**\n * Obtain the return type of a function type\n *&#x2F;\ntype ReturnType&lt;T extends (...args: any) &#x3D;&gt; any&gt; &#x3D; T extends (...args: any) &#x3D;&gt; infer R ? R : any;\n\nå®ƒçš„ç”¨æ³•éå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š\nconst add &#x3D; (x: number, y: number) &#x3D;&gt; x + y\n\ntype Type1 &#x3D; typeof add &#x2F;&#x2F; (x: number, y: number) &#x3D;&gt; number\ntype T1 &#x3D; ReturnType&lt;Type1&gt; &#x2F;&#x2F; number\n\nT extends (...args: any) =&gt; any è¿™ä¸€è¡Œä»£ç å°±æ˜¯çº¦æŸä¼ å…¥ ReturnType çš„æ³›å‹å‚æ•°ç±»å‹å¿…é¡»æ˜¯å‡½æ•°ç±»å‹ï¼Œè¿™å°±ç±»ä¼¼äºå‚æ•°æ ¡éªŒã€‚è¿™é‡Œçš„ T å°±æ˜¯ add å‡½æ•°çš„ç±»å‹ (x: number, y: number) =&gt; number ã€‚\né‚£ä¹ˆ T extends (...args: any) =&gt; infer R ? R : any ä»£ç çš„å«ä¹‰å¯ä»¥ç†è§£ä¸ºï¼šå¦‚æœ T (x: number, y: number) =&gt; number æ»¡è¶³äº (â€¦args: any) =&gt; infer R çš„è¡¨ç°å½¢å¼çš„è¯ï¼Œå°±è¿”å› Rï¼Œå¦åˆ™è¿”å› any ã€‚\ninfer R è¡¨ç¤ºå£°æ˜ä¸€ä¸ªå¾…æ¨æ–­çš„ç±»å‹ï¼Œå¹¶å°†æ¨æ–­å‡ºæ¥çš„ç±»å‹å­˜å‚¨åœ¨ R ä¸­ã€‚è¿™é‡Œ T æ˜¯ (x: number, y: number) =&gt; number ï¼Œinfer R è¢«æ”¾åœ¨ (...args: any) =&gt; infer R å‡½æ•°ç±»å‹çš„è¿”å›å€¼å¤„ï¼Œå› æ­¤æ¨æ–­å‡ºäº† number ç±»å‹å¹¶èµ‹å€¼ç»™ R ã€‚\ninfer æ¨æ–­å‡½æ•°å‚æ•°ç±»å‹ReturnType å€ŸåŠ© infer å®ç°è·å–å‡½æ•°çš„è¿”å›å€¼ç±»å‹ï¼Œé‚£ä¹ˆå¦‚ä½•è·å–å‡½æ•°å‚æ•°ç±»å‹ï¼Ÿè™½ç„¶ TypeScript å·²å®ç°è¯¥å·¥å…·å‡½æ•°ï¼Œä½†ä¸å¦¨ç¢æˆ‘ä»¬å†™ä¸€ä¸ªã€‚å¾ˆç®€å•ï¼Œåœ¨ ReturnType  ä¸Šæ”¹ä¸€ä¸‹å³å¯ï¼š\ntype ParamsType&lt;T extends (...args: any) &#x3D;&gt; any&gt; &#x3D; T extends (...args: infer R) &#x3D;&gt; any ? R : any;\n\nä»…æ˜¯å°† infer R è·Ÿå‚æ•°ç±»å‹ any è°ƒæ¢ä¸€ä¸‹å°±å®ç°äº†ï¼Œçœ‹ä¸‹æ‰“å°ï¼š\ntype ParamsType&lt;T extends (...args: any) &#x3D;&gt; any&gt; &#x3D; T extends (...args: infer R) &#x3D;&gt; any ? R : any;\n\nconst add &#x3D; (a: number, b: string) &#x3D;&gt; a + b\n\n\ntype TypeAdd &#x3D; typeof add &#x2F;&#x2F; (a: number, b: string) &#x3D;&gt; string\n\ntype T1 &#x3D; ParamsType&lt;TypeAdd&gt; &#x2F;&#x2F; [number, string]\n\nconst arr: T1 &#x3D; [1, 2] &#x2F;&#x2F; Error: Type &#39;number&#39; is not assignable to type &#39;string&#39;.\n\nç”±äºä¸Šè¿°é‡‡ç”¨çš„æ˜¯ ES6 rest å‚æ•°å†™æ³•ï¼Œæ‰€ä»¥å®ƒä¼šæ¨æ–­å‡ºä¸€ä¸ªå…ƒç»„ç±»å‹ï¼Œå¦‚æœæ˜¯æƒ³è·å–å•ä¸ªå‚æ•°ç±»å‹å¯ä»¥è¿™æ ·å†™ï¼š\ntype ParamType&lt;T extends (arg: any) &#x3D;&gt; any&gt; &#x3D; T extends (arg: infer R) &#x3D;&gt; any ? R : any;\n\næ€»ç»“ä»¥ä¸Šä¾¿æ˜¯æˆ‘å¯¹äº infer çš„ç²—æµ…ç†è§£ï¼Œå…¶å® infer å¾ˆå¼ºå¤§èƒ½å®ç°æ›´å¤šçš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼šå°†ç±»æ„é€ å‡½æ•°ç±»å‹çš„å‚æ•°æ¨æ–­ä¸ºå…ƒç»„çš„ ConstructorParameters ã€è·å–æ„é€ å‡½æ•°ç±»å‹çš„è¿”å›ç±»å‹çš„ InstanceType ï¼Œè¿˜èƒ½é€šè¿‡ infer æ¨æ–­å‡ºæ•°ç»„çš„å­å…ƒç´ ç±»å‹ç­‰ç­‰ä¸€ç³»åˆ—éªšæ“ä½œâ€¦â€¦\nå¹¶ä¸” Vue3 ä¸­çš„ ref ä¸ºä»€ä¹ˆèƒ½å¤Ÿå®ç°å„ç§å¤æ‚çš„ç±»å‹æ¨æ–­ï¼Œä¹Ÿæ˜¯é€šè¿‡ infer æ¥å®ç°çš„ï¼Œå†™çš„æœ‰ç‚¹å¤æ‚ï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥çœ‹ä¸€ä¸‹ Vue3 ref æºç   ã€‚\nå‚è€ƒ\nhttps://www.tslang.cn/docs/release-notes/typescript-2.8.html\nhttps://www.wenjiangs.com/doc/typescript-infer\n\n","slug":"ts-infer","date":"2021-12-23T09:33:00.000Z","categories_index":"","tags_index":"","author_index":"Aurora"},{"id":"506ca00e65144df18d66801c0d8409c9","title":"Greedy Snake","content":"æ•ˆæœå›¾æœ€è¿‘ä½¿ç”¨ JS å†™äº†ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n\nè°·æ­Œæµè§ˆå™¨ç‚¹å‡»ç›´æ¥åœ¨çº¿ç©\nå‰è¨€è´ªåƒè›‡ä½œä¸ºä¸€æ¬¾ç»å…¸åˆç®€å•çš„å°æ¸¸æˆï¼Œæ¯ä¸ªäººéƒ½ç©è¿‡ã€‚å®ç°ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆåŸºæœ¬å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š\n\næ£‹ç›˜ï¼ˆä¹Ÿè¢«ç§°ä½œ â€œåœ°å›¾â€ï¼Œæˆ‘è¿™é‡Œç”»çš„åƒä¸€ä¸ªå›´æ£‹æ£‹ç›˜ï¼Œç´¢æ€§å°±å«æ£‹ç›˜ï¼‰\nè›‡ ï¼ˆç»†è‡´ä¸€ç‚¹åˆ†ä¸ºï¼šè›‡å¤´ã€è›‡èº«ã€è›‡å°¾ï¼‰\næ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³ï¼‰æ§åˆ¶ï¼Œå¹¶ä¸”è‡ªåŠ¨è¡Œèµ°\nç¢°æ’æ£€æµ‹ï¼ˆæ’å¢™ã€æ’è‡ªå·±ï¼‰\né£Ÿç‰©åœ¨éšæœºä½ç½®ç”Ÿæˆ\nè›‡åƒåˆ°é£Ÿç‰©ï¼Œå°¾éƒ¨ç”Ÿé•¿ä¸€æˆª\n\nä»¥ä¸Šä¹Ÿä¾¿æ˜¯æˆ‘çš„å®ç°æ­¥éª¤äº†ï¼Œä¸‹é¢åˆ†äº«ä¸€äº›æ›´è¯¦ç»†çš„å®ç°æ€è·¯ã€‚\næ£‹ç›˜æ£‹ç›˜å°±æ˜¯è›‡è¿åŠ¨çš„åŒºåŸŸï¼Œç®€é™‹ä¸€ç‚¹ç”šè‡³å¯ä»¥ä¸è¦è¾¹æ¡†ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½çš„æ¸¸æˆä½“éªŒï¼Œè¿™é‡Œè¿˜æ˜¯åŠ ä¸Šè¾¹æ¡†ã€‚ä½†æ˜¯æ­¤è¾¹æ¡†éå½¼è¾¹æ¡†ï¼Œä½¿ç”¨ border æ¥å®ç°æ•ˆæœå›¾ä¸­çš„è¾¹æ¡†ä¹Ÿå¯ä»¥ï¼Œä½†è¿™é‡Œæˆ‘é‡‡ç”¨äº†å…¶ä»–çš„æ–¹å¼ï¼Œæ¯”å¦‚ èƒŒæ™¯è‰² ï¼Œçœ‹ä¸‹å›¾ï¼š\n\né€šè¿‡å±‚çº§ã€å®šä½ï¼Œä½¿å¾—é»‘å—æˆä¸ºäº†è“å—è§†è§‰ä¸Šçš„è¾¹æ¡†ï¼Œç„¶åç»“åˆ grid ç½‘æ ¼å¸ƒå±€å®ç° æ ¼æ ¼åˆ†æ˜ çš„æ£‹ç›˜ä¾¿å°¤ä¸ºç®€å•ã€‚\n\nè¿™é‡Œä¸€ä¸ªå¤§å—é‡‡ç”¨ é»‘è‰²èƒŒæ™¯ ï¼Œ400ä¸ªå°å—é‡‡ç”¨ ç™½è‰²èƒŒæ™¯ ï¼Œä½¿ç”¨ grid å¸ƒå±€æ¨ªã€çºµåˆ†åˆ« 20 ä¸ªä¾æ¬¡æ’åˆ—ï¼Œå†åŠ ä¸Šç½‘æ ¼çš„è¡Œã€åˆ—é—´è·ï¼Œä¾¿èƒ½å½¢æˆå›´æ£‹æ£‹ç›˜å¼çš„å¸ƒå±€ã€‚è¿™é‡Œçš„é»‘çº¿å®åˆ™å°±æ˜¯ é®æŒ¡+é—´éš™ å½¢æˆçš„ï¼Œä»£ç å¦‚ä¸‹ï¼š\n&lt;style&gt;\n&#x2F;&#x2F; å¤§å—\n#checkerboard &#123;\n    display: grid;\n    grid-template-columns: repeat(20, 16px);\n    grid-template-rows: repeat(20, 16px);\n    grid-column-gap: 1px;\n    grid-row-gap: 1px;\n    padding: 1px;\n    background: #000;\n&#125;\n\n&#x2F;&#x2F; å°å—\n.square &#123;\n    background: #fff;\n&#125;\n&lt;&#x2F;style&gt;\n\nå› ä¸ºæ˜¯ grid å¸ƒå±€ï¼Œæ‰€æœ‰ä¸€äº› ä¸Šå¤æµè§ˆå™¨ å°±ä¸èƒ½ç©è¿™ä¸ªæ¸¸æˆäº†ã€‚\n\nåæ ‡å¾ˆå¤šæ¸¸æˆéƒ½æœ‰åæ ‡çš„æ¦‚å¿µï¼Œè´ªåƒè›‡æ”¯æŒè‡ªåŠ¨è¡Œèµ°ã€é£Ÿç‰©ç”Ÿæˆåœ¨éšæœºä½ç½®ä»¥åŠç¢°æ’æ£€æµ‹ç­‰åŠŸèƒ½éƒ½æ˜¯ä¾æ®åæ ‡æ¥å®ç°çš„ã€‚\næˆ‘è¿™é‡Œçš„åæ ‡å®ç°å¾ˆç®€å•ï¼šç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªæ ¼å­åæ ‡ä¸º 1-1ï¼Œç¬¬ä¸€è¡Œæœ€åä¸€ä¸ªæ ¼å­åæ ‡ä¸º 1-20\n\nåœ¨ç”Ÿæˆ div æ—¶å°†æ¯ä¸€ä¸ªæ ¼å­ å¯¹åº”çš„åæ ‡ é€šè¿‡ cssç±»å å¯¹åº”èµ·æ¥ï¼Œä»£ç å¦‚ä¸‹ï¼š\n&#x2F;**\n * æ£‹ç›˜ 20 * 20\n * åæ ‡ï¼š1-1, ... 1-20, ... 20-20\n *&#x2F;\nclass Checkerboard &#123;\n    constructor(container, gridNum) &#123;\n        this.container &#x3D; container\n        this.gridNum &#x3D; gridNum\n        this.generate()\n    &#125;\n\n    &#x2F;&#x2F; æ¯ä¸ªæ ¼å­ç±»åä¸ºï¼šSXè½´åæ ‡_Yè½´åæ ‡ S1_20\n    generate() &#123;\n        const fragment &#x3D; document.createDocumentFragment()\n        for (let i &#x3D; 0; i &lt; this.gridNum; i++) &#123;\n            for (let j &#x3D; 0; j &lt; this.gridNum; j++) &#123;\n                const grid &#x3D; document.createElement(&#39;div&#39;)\n                grid.classList.add(&#39;square&#39;, &#96;S$&#123;j + 1&#125;_$&#123;i + 1&#125;&#96;)\n                fragment.appendChild(grid)\n            &#125;\n        &#125;\n        this.container.appendChild(fragment)\n    &#125;\n&#125;\nè¿™æ ·ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ª div çš„ç±»åæ˜¯ S1_1ï¼Œç¬¬ä¸€è¡Œæœ€åä¸€ä¸ª div çš„ç±»åä¸º S1_20ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼Œè¿™ä¸ª css ç±»åçš„è®¾è®¡å°±æ˜¯è¿™ä¸ªæ¸¸æˆçš„æ ¸å¿ƒè®¾è®¡ ï¼Œå› ä¸ºåç»­çš„è‡ªåŠ¨è¡Œèµ°ã€é£Ÿç‰©ç”Ÿæˆåœ¨éšæœºä½ç½®ä»¥åŠç¢°æ’æ£€æµ‹ç­‰åŠŸèƒ½å…¨éƒ¨éƒ½æ˜¯åœ¨æ“ä½œ cssç±»å ã€‚\næ›´è¯¦ç»†ä»£ç å¯ä»¥åœ¨åº•éƒ¨æŸ¥çœ‹æºç ~\nè›‡ã€é£Ÿç‰©çš„ç»˜åˆ¶å¾ˆå¤šæ—¶å€™é‡‡ç”¨ CSS æ ·å¼ ç»“åˆ cssç±»å çš„åˆ‡æ¢èƒ½æ›´å¥½ã€æ›´å¿«ã€æ›´é«˜æ€§èƒ½çš„å®ç°åŠ¨ç”»æˆ–è€…å…¶ä»–çš„é€»è¾‘ã€‚é‚£ä¹ˆåœ¨è¿™é‡Œ è›‡ å’Œ é£Ÿç‰© ç»˜åˆ¶æˆ‘ç›´æ¥é€šè¿‡åŠ  cssç±»å å°±è§£å†³äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š\n&lt;style&gt;\n.square &#123;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: #fff;\n&#125;\n\n.snake::after &#123;\n    display: block;\n    content: &#39;&#39;;\n    width: 70%;\n    height: 70%;\n    border-radius: 100%;\n    background: #9bbef8;\n&#125;\n\n.snake.head::after &#123;\n    background: #0037ff;\n&#125;\n\n.snake.tail::after &#123;\n    background: #7400d2;\n&#125;\n\n.food::after &#123;\n    display: block;\n    content: &#39;&#39;;\n    width: 70%;\n    height: 70%;\n    border-radius: 100%;\n    background: #d54830;\n&#125;\n&lt;&#x2F;style&gt;\n\nå°†ç›¸åº”çš„ css ç±»å åŠ åœ¨ .square ä¸Šå°±ç”Ÿæˆäº†è›‡å’Œé£Ÿç‰©äº†ï¼Œç²—æš´ä¸€ç‚¹ä¼ªå…ƒç´ å¯ä»¥ä¸ç”¨ï¼Œè¿™é‡Œä¸ºäº†ç¾è§‚ä¸€ç‚¹ä½¿ç”¨ ä¼ªå…ƒç´ +åœ†è§’ ä¿®é¥°ä¸€ä¸‹ã€‚\n\nè›‡çš„è¡Œèµ° &amp; ç¢°æ’æ£€æµ‹ &amp; åƒåˆ°é£Ÿç‰©ä»¥ä¸Šä¸‰ä¸ªåŠŸèƒ½éƒ½æ˜¯ä¾æ®åæ ‡æ¥å®ç°çš„ï¼Œç´¢æ€§æ”¾åœ¨ä¸€èµ·è®²\nè›‡çš„è¡Œèµ°\nå°±å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®ç°è›‡çš„è¡Œèµ°å…¶å®éå¸¸ç®€å•ï¼Œè¿™é‡Œåªéœ€è¦æƒ³æ‡‚ä¸€ç‚¹å³å¯ï¼šæ¯æ¬¡ç§»åŠ¨ï¼Œé™¤äº†è›‡å¤´åæ ‡(è“è‰²åœ†ç‚¹)æ˜¯ä¸€ä¸ªå…¨æ–°çš„åæ ‡ï¼Œå…¶ä»–åœ†ç‚¹çš„åæ ‡éƒ½æ˜¯å®ƒä¹‹å‰çš„é‚£ä¸€ä¸ªåæ ‡ ã€‚è¿™é‡Œè›‡çš„åŸå§‹åæ ‡æ˜¯ [&#39;12-13&#39;, &#39;11-13&#39;, &#39;10-13&#39;] ï¼Œé‚£ä¹ˆå®ƒå¾€å³èµ°çš„è¯åªè¦å°† 13-13 ä½œä¸ºè›‡å¤´åæ ‡å³å¯ï¼Œä¸Šä¸€æ®µæ¨¡æ‹Ÿä»£ç ï¼š\nconst arr &#x3D; [&#39;12-13&#39;, &#39;11-13&#39;, &#39;10-13&#39;]\n\n&#x2F;&#x2F; åˆ é™¤è›‡å°¾åæ ‡\narr.pop()\n\n&#x2F;&#x2F; åŠ å…¥æ–°çš„è›‡å¤´åæ ‡\narr.unshift(&#39;13-13&#39;)\n\n&#x2F;&#x2F; arr &#x3D;&gt; [&#39;13-13&#39;, &#39;12-13&#39;, &#39;11-13&#39;]\n\nè›‡å°¾åæ ‡è‚¯å®šè¦åˆ çš„ï¼Œä¸ç„¶è›‡ä¸åƒé£Ÿç‰©éƒ½èƒ½ç”Ÿé•¿äº†ï¼Œå¯ä»¥è„‘è¡¥ä¸€ä¸‹ç”»é¢~\nåœ¨ä¸€å¼€å§‹ç”Ÿæˆæ£‹ç›˜çš„æ—¶å€™ï¼Œæ¯ä¸ª æ ¼å­(div) éƒ½å·²ç»ç»‘å®šä¸Šä¸åæ ‡ç›¸å¯¹åº”çš„ cssç±»å ï¼Œè¿™é‡Œæ ¹æ®ä¸Šé¢çš„åæ ‡æ•°ç»„å°†ç›¸åº”çš„ div  æ·»åŠ /ç§»é™¤cssç±»å å³å¯ã€‚\nç¢°æ’æ£€æµ‹\nç¢°æ’æ£€æµ‹ å¬èµ·æ¥å¥½åƒ â€ä¸€å¤´é›¾æ°´ğŸ˜²ğŸ˜²ä»€ä¹ˆä¸œä¸œğŸ˜±ğŸ˜±â€œï¼Œä½†æ˜¯ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆçš„ç¢°æ’æ£€æµ‹è¿˜èƒ½æœ‰å¤šéš¾ã€‚åŸç†å…¶å®å°±æ˜¯è¿™æ ·ï¼šè›‡åªèƒ½åœ¨æ£‹ç›˜å†…æ´»åŠ¨ï¼Œè›‡å­˜åœ¨çš„ æœ‰æ•ˆåæ ‡ ä¹Ÿåªèƒ½åŒ…å«åœ¨æ£‹ç›˜å†…ã€‚è¿™é‡Œæ¨ªçºµåæ ‡æœ€å°ã€æœ€å¤§å€¼åˆ†åˆ«æ˜¯ 1 ã€20ï¼Œ åªéœ€è¦åˆ¤æ–­ è›‡å¤´åæ ‡ æ˜¯å¦åœ¨ 1-20 ä»¥å†…(åŒ…å«1å’Œ20)å°±å¯ä»¥äº†ã€‚\nåƒåˆ°é£Ÿç‰©åƒåˆ°é£Ÿç‰©å…¶å®ä¹Ÿæ˜¯ç¢°æ’æ£€æµ‹çš„ä¸€ç§ï¼Œåˆ¤æ–­ æ–°çš„è›‡å¤´åæ ‡ å’Œ é£Ÿç‰©åæ ‡ ä¸€æ ·å³ä¸ºåƒåˆ°é£Ÿç‰©ï¼Œå¹¶ä¸”ä¼šåœ¨å½“å‰è›‡å°¾å‘¨å›´å¯ç”¨åæ ‡ä¸­éšæœºç”Ÿæˆä¸€ä¸ªæ–°çš„è›‡å°¾åæ ‡ï¼Œå¦‚ä¸‹å›¾ï¼š\n\nå½“è›‡å¤´å’Œé£Ÿç‰©é‡åˆåï¼Œæ·¡è“çš„åœ†ç‚¹ä¾¿æˆäº†æ–°çš„è›‡å°¾åæ ‡ï¼Œå¹¶ä¸”ä¼šåœ¨çº¢è‰²ç®­å¤´æ‰€ç¤ºçš„åæ ‡ä¸­éšæœºé€‰ä¸€ä¸ªå½“åšæ–°çš„è›‡å°¾åæ ‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ æ–°çš„è›‡å°¾åæ ‡ å¯èƒ½ä¼šä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ­¤æ—¶å°± game over äº†ã€‚\næ€»ç»“æ›´å¤šä»£ç ä¹Ÿå°±ä¸è´´äº†ï¼Œä»¥ä¸Šä¹ŸåŸºæœ¬å°†è¿™ä¸ªå°æ¸¸æˆçš„æ ¸å¿ƒéƒ½è®²éäº†ï¼Œå…³äº æ¨¡å¼ å®åˆ™æ˜¯åæ ‡çš„å¦ä¸€ç§ç®€å•è¿ç”¨ç½¢äº†ï¼Œéš¾åº¦ æ›´ä»…ä»…æ˜¯å®šæ—¶å™¨çš„æ—¶é—´æ”¹å˜è€Œå·²ã€‚è¿˜æœ‰å¾ˆå¤šæƒ³æ³•åç»­æœ‰æ—¶é—´å†å®ç°å§ï¼Œå¦‚ä¸‹ï¼š\n\nç­‰çº§ç§°å·ï¼ˆè¾¾æˆç›¸åº”çš„åˆ†æ•°æ¥å®ç°ç›¸åº”çš„ç§°å·ï¼Œæ¯”å¦‚ï¼šåˆå‡ºèŒ…åºâ€¦â€¦ï¼‰\nåŠ é€ŸåŠŸèƒ½ï¼ˆæŒ‰ä½ç©ºæ ¼é”®æ¥æ ¹æ®å®šæ—¶å™¨çš„æ—¶é—´å®ç°åŠ é€Ÿï¼‰\nå­˜æ¡£åŠŸèƒ½ï¼ˆæŒ‰ä½ä¸ªä»€ä¹ˆé”®ä¿å­˜å½“å‰è›‡çš„åæ ‡ã€æ¨¡å¼ç­‰ä¿¡æ¯ï¼Œå­˜å…¥æœ¬åœ°ç¼“å­˜ï¼Œä¸‹æ¬¡å†ç©ï¼‰\nå‘¨æœŸæ€§å‡ºç°ä¸€ä¸ª å¤§é£Ÿç‰© ä¸€æ¬¡é•¿å¥½å‡ èŠ‚\nç­‰ç­‰ç­‰ç­‰~\n\næºç https://gitee.com/dizuncainiao/dz-greedysnake\n","slug":"greedy-snake","date":"2021-12-23T07:47:51.000Z","categories_index":"","tags_index":"","author_index":"Aurora"},{"id":"e27ca51324eb3fbf12d00b0c949efce4","title":"Event Bus","content":"å‰è¨€æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ Vue ä¸­çˆ¶å­ç»„ä»¶é€šä¿¡ä½¿ç”¨ propsã€$emitï¼Œå…„å¼Ÿç»„ä»¶æˆ–è€…è·¨ç»„ä»¶ä¹‹é—´å¯ä»¥é€šè¿‡ Vuex æˆ– EventBus ï¼ŒåŒ…æ‹¬ $parent ã€$root å’Œ $refs éƒ½æ˜¯å¯ä»¥è¾¾åˆ°é€šä¿¡çš„ç›®çš„ï¼Œæ€»ä¹‹ Vue ç»„ä»¶ä¹‹é—´çš„é€šä¿¡æ–¹å¼éå¸¸ä¸°å¯Œã€‚\nä»Šå¤©çš„ä¸»è§’æ˜¯EventBus ï¼Œé‚£ä¹ˆå…ˆè°ˆè°ˆæˆ‘å¯¹å®ƒçš„ç†è§£ã€‚\nEventBus ä¹‹æ‰€ä»¥èƒ½å®ç°å…¨å±€è·¨ç»„ä»¶é€šä¿¡é¦–å…ˆå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡æŒ‚åœ¨ window æˆ– Vue.prototype ä¸Šï¼Œå¹¶ä¸”èƒ½é€šè¿‡è§¦å‘äº‹ä»¶ä¼ å‚æ¥å®ç°æ•°æ®çš„ä¼ é€’ã€‚\nåœ¨å°å‹é¡¹ç›®ï¼ˆäºŒä¸‰åä¸ªé¡µé¢ï¼‰ä¸­ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒå‹å¥½çš„ï¼Œæ¯”èµ· Vuex è¦æ¥çš„ç®€å•ç²—æš´ä¸€ç‚¹ã€‚å› ä¸º Vuex éœ€è¦å»ºç«‹ mutations ã€actions ï¼ŒæŸäº›é€»è¾‘äº¤äº’ç”šè‡³éœ€è¦å€ŸåŠ© computed + watch æ¥å®ç°ï¼Œè¿™åœ¨å°é¡¹ç›®ä¸­æ˜¾å¾—æ¯”è¾ƒè‡ƒè‚¿ã€‚\nåœ¨å¤§å‹é¡¹ç›®ï¼ˆå‡ ç™¾ä¸ªé¡µé¢ï¼‰ä¸­ä½¿ç”¨ EventBus ä¸æ˜¯ä¸è¡Œï¼Œå°±æ˜¯è¿™é‡Œé¢æ°´å¾ˆæ·±ï¼Œå¾ˆéš¾æŠŠæ¡çš„ä½â€¦â€¦\n\nEventBus çš„ç¼ºç‚¹å°±æ˜¯ Vuex çš„ä¼˜ç‚¹ï¼Œç¼ºä¹ çŠ¶æ€ç®¡ç† ã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨çœ‹ä¸€æ®µä»£ç æ—¶ï¼Œçœ‹åˆ° $emit(&#39;someEvent&#39;) æˆ–  $on(&#39;someEvent&#39;)åæƒ³è¦çŸ¥é“å®ƒåˆ†åˆ«åœ¨å“ªé‡Œè¢«ç›‘å¬ï¼Œåœ¨å“ªé‡Œè¢«è§¦å‘ï¼Œç„¶åå…¨å±€ä¸€æœç«Ÿç„¶æœ‰å‡ åå¤„ï¼Œè¿™â€¦â€¦ğŸ˜µ\nä½†è¿™å¹¶ä¸æ„å‘³ç€ EventBus åœ¨å¤§å‹é¡¹ç›®ä¸­å°±ä¸èƒ½ç”¨ï¼ŒäºŒè€…ç»“åˆèµ·æ¥ç”¨æ‰æ˜¯æœ€é¦™çš„ã€‚æ¯”å¦‚è¿™æ ·çš„åœºæ™¯ï¼šæ ¹æ®çˆ¶ç»„ä»¶ä¸­å¯¼èˆªèœå•çš„å¼€åˆçŠ¶æ€åœ¨å­ç»„ä»¶ä¸­å¤„ç†ä¸€äº›é€»è¾‘ ï¼Œç±»ä¼¼äºè¿™æ ·çš„åœºæ™¯ä½¿ç”¨ EventBus æ˜¯ä¸æ˜¯è¦ç®€å•ç²—æš´ä¸€ç‚¹ï¼Œè§¦å‘ä¸ªäº‹ä»¶å°±è§£å†³äº†ã€‚EventBus æ¯”è¾ƒé€‚åˆåœ¨é‚£ç§ å®šå‘çš„ã€è€¦åˆåº¦è¾ƒä½ çš„åŠŸèƒ½åœºæ™¯ä¸­ä½¿ç”¨ã€‚\nå¯¹äº Vuex å’Œ EventBus ä¹‹é—´æˆ‘è§‰å¾—åŸºæœ¬ä¸Šèƒ½å¤Ÿç›¸äº’æ›¿ä»£ï¼Œä½†æ˜¯ä¸èƒ½å®Œç¾æ›¿ä»£ã€‚è¿™ä¸¤è€…åœ¨æˆ‘çš„æ—¥å¸¸å¼€å‘ä¸­éƒ½æ˜¯ç¼ºä¸€ä¸å¯çš„ï¼Œä½†æ˜¯å°±æ˜¯è¿™ä¹ˆå¥½ç”¨çš„ EventBus  åœ¨ Vue3 ä¸­è¢«ç§»é™¤äº†ï¼Œæ€ä¹ˆåŠğŸ¤”ï¼Œå—¯ã€‚ã€‚ã€‚è¦ä¸å†™ä¸€ä¸ªï¼Ÿ\næ­¥éª¤åšä»»ä½•äº‹æƒ…éƒ½æ˜¯åˆ†æ­¥éª¤çš„ï¼ŒæŠŠå¤§è±¡è£…è¿›å†°ç®±é‡Œè¿˜åˆ†æˆ 3 æ­¥å‘¢ï¼Œé‚£ä¹ˆå†™ä¸€ä¸ª EventBus å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š\n\non ç”¨æ¥ç›‘å¬å½“å‰å®ä¾‹ä¸Šçš„è‡ªå®šä¹‰äº‹ä»¶ã€‚äº‹ä»¶å¯ä»¥ç”± emit è§¦å‘ã€‚å›è°ƒå‡½æ•°ä¼šæ¥æ”¶æ‰€æœ‰ä¼ å…¥äº‹ä»¶è§¦å‘å‡½æ•°çš„é¢å¤–å‚æ•°ã€‚\n\nonce ç›‘å¬ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œä½†æ˜¯åªè§¦å‘ä¸€æ¬¡ã€‚ä¸€æ—¦è§¦å‘ä¹‹åï¼Œç›‘å¬å™¨å°±ä¼šè¢«ç§»é™¤ã€‚\n\noff ç§»é™¤è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨ã€‚\n\nå¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™ç§»é™¤æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼›\nå¦‚æœåªæä¾›äº†äº‹ä»¶ï¼Œåˆ™ç§»é™¤è¯¥äº‹ä»¶æ‰€æœ‰çš„ç›‘å¬å™¨ï¼›\nå¦‚æœåŒæ—¶æä¾›äº†äº‹ä»¶ä¸å›è°ƒï¼Œåˆ™åªç§»é™¤è¿™ä¸ªå›è°ƒçš„ç›‘å¬å™¨ã€‚\n\n\nemit è§¦å‘å½“å‰å®ä¾‹ä¸Šçš„äº‹ä»¶ã€‚é™„åŠ å‚æ•°éƒ½ä¼šä¼ ç»™ç›‘å¬å™¨å›è°ƒã€‚\n\n\nä¸ºäº†å°½é‡ 1:1 æ¨¡æ‹Ÿå‡º Vue2 ä¸­çš„ç”¨æ³•ï¼Œè¿™é‡Œå°±ç›´æ¥ç…§æ¬äº† Vue2 ä¸­çš„ #å®ä¾‹æ–¹æ³•-äº‹ä»¶ ã€‚æœ‰äº†æ­¥éª¤ä»¥åå®ç°ä¸€ä¸ª EventBus å°±å·²ç»å®Œæˆäº†ä¸€å¤§åŠäº†ï¼Œä¸‹é¢å¾…æˆ‘æ…¢æ…¢é“æ¥ã€‚\näº‹ä»¶ç›‘å¬-onon æ–¹æ³•ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ äº‹ä»¶ string ï¼Œç¬¬äºŒä¸ªæ˜¯ å›è°ƒå‡½æ•° ã€‚on ä¸å…¶è¯´æ˜¯äº‹ä»¶ç›‘å¬ï¼Œä¸å¦‚å°†å®ƒç†è§£ä¸º æ³¨å†Œ ã€ç™»è®° ï¼Œå› ä¸º on çš„æ ¸å¿ƒå°±æ˜¯å°† äº‹ä»¶ ä»¥åŠå¯¹åº”çš„ å›è°ƒ æ”¶é›†ä¾› emit è§¦å‘ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š\nclass DzEmitter &#123;\n    _events &#x3D; &#123;&#125;\n\n    static addEvent(e, callback, isOnce &#x3D; false) &#123;\n        const &#123;_events&#125; &#x3D; this\n        const keys &#x3D; Object.keys(_events)\n        if (keys.includes(e)) &#123;\n            _events[e].isOnce &#x3D; isOnce\n            _events[e].callbacks.push(callback)\n        &#125; else &#123;\n            _events[e] &#x3D; &#123;\n                isOnce,\n                callbacks: [callback]\n            &#125;\n        &#125;\n    &#125;\n\n    &#x2F;&#x2F; ç›‘å¬å½“å‰å®ä¾‹ä¸Šçš„è‡ªå®šä¹‰äº‹ä»¶\n    on(e, callback) &#123;\n        DzEmitter.addEvent.call(this, e, callback)\n    &#125;\n&#125;\n\nè¿™é‡Œä½¿ç”¨ _events æ¥æ”¶é›† äº‹ä»¶ ä¸ å›è°ƒ ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ª äº‹ä»¶ å¯ä»¥å¯¹åº”å¤šä¸ª å›è°ƒ ï¼Œå› æ­¤è¦åŠ ä»¥å¤„ç†ä¸‹ã€‚ä¸€ä¸ªæ³¨å†Œäº†å¤šä¸ªç›¸åŒäº‹ä»¶çš„ _events æ•°æ®å¦‚ä¸‹ï¼š\nconst _events &#x3D; &#123;\n    selfClick: &#123;\n        isOnce: true,\n        callbacks: [fn, fn2]\n    &#125;\n&#125;\n\nisOnce æ˜¯ç”¨æ¥åˆ¤æ–­æ³¨å†Œæ¥æºæ˜¯ once è¿˜æ˜¯ on ã€‚\näº‹ä»¶è§¦å‘-emitemit ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ äº‹ä»¶ string ï¼Œç¬¬äºŒä¸ªæ˜¯ ä¼ ç»™å›è°ƒçš„å‚æ•° ã€‚å…¶æ ¸å¿ƒå°±æ˜¯æ ¹æ® äº‹ä»¶åç§° ï¼ŒæŠŠå‚æ•°ä¼ ç»™ å›è°ƒ ï¼Œå¹¶è°ƒç”¨ å›è°ƒå‡½æ•° å°±è¡Œäº†ã€‚æ ¹æ®ä¸Šé¢çš„ _events æ•°æ®ï¼Œå†™å‡ºä»¥ä¸‹ä»£ç ï¼š\n&#x2F;&#x2F; è§¦å‘å½“å‰å®ä¾‹ä¸Šçš„äº‹ä»¶ã€‚é™„åŠ å‚æ•°éƒ½ä¼šä¼ ç»™ç›‘å¬å™¨å›è°ƒã€‚\nemit(e, data) &#123;\n    try &#123;\n        const &#123;callbacks, isOnce&#125; &#x3D; this._events[e]\n        callbacks.forEach(fn &#x3D;&gt; fn(data))\n        isOnce &amp;&amp; this.off(e)\n    &#125; catch (e) &#123;\n        console.error(e)\n    &#125;\n&#125;\n\nå› ä¸ºä¸€ä¸ª äº‹ä»¶ å¯¹åº”å¤šä¸ª å›è°ƒ ï¼Œæ‰€ä»¥è§¦å‘äº‹ä»¶æ—¶å®ƒå¯¹åº”çš„æ•°ä¸ªå›è°ƒè¦ä¸€åŒè°ƒç”¨ã€‚ç”± once æ³¨å†Œçš„äº‹ä»¶éœ€è¦åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨åé”€æ¯æ‰ã€‚\nå®Œæ•´ä»£ç å…³äº once å’Œ off å°±ä¸å•ç‹¬è®²äº†ï¼Œç›´æ¥ä¸Šå…¨éƒ¨ä»£ç ï¼š\nclass DzEmitter &#123;\n    _events &#x3D; &#123;&#125;\n\n    static addEvent(e, callback, isOnce &#x3D; false) &#123;\n        const &#123;_events&#125; &#x3D; this\n        const keys &#x3D; Object.keys(_events)\n        if (keys.includes(e)) &#123;\n            _events[e].isOnce &#x3D; isOnce\n            _events[e].callbacks.push(callback)\n        &#125; else &#123;\n            _events[e] &#x3D; &#123;\n                isOnce,\n                callbacks: [callback]\n            &#125;\n        &#125;\n    &#125;\n\n    &#x2F;&#x2F; è§¦å‘å½“å‰å®ä¾‹ä¸Šçš„äº‹ä»¶ã€‚é™„åŠ å‚æ•°éƒ½ä¼šä¼ ç»™ç›‘å¬å™¨å›è°ƒã€‚\n    emit(e, data) &#123;\n        try &#123;\n            const &#123;callbacks, isOnce&#125; &#x3D; this._events[e]\n            callbacks.forEach(fn &#x3D;&gt; fn(data))\n            isOnce &amp;&amp; this.off(e)\n        &#125; catch (e) &#123;\n            console.error(e)\n        &#125;\n    &#125;\n\n    &#x2F;&#x2F; ç›‘å¬å½“å‰å®ä¾‹ä¸Šçš„è‡ªå®šä¹‰äº‹ä»¶\n    on(e, callback) &#123;\n        DzEmitter.addEvent.call(this, e, callback)\n    &#125;\n\n    &#x2F;&#x2F; ç›‘å¬ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œä½†æ˜¯åªè§¦å‘ä¸€æ¬¡ã€‚ä¸€æ—¦è§¦å‘ä¹‹åï¼Œç›‘å¬å™¨å°±ä¼šè¢«ç§»é™¤\n    once(e, callback) &#123;\n        DzEmitter.addEvent.call(this, e, callback, true)\n    &#125;\n\n    &#x2F;&#x2F; ç§»é™¤è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨\n    off(e, callback) &#123;\n        &#x2F;&#x2F; å¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™ç§»é™¤æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨\n        if (!arguments.length) &#123;\n            this._events &#x3D; &#123;&#125;\n        &#125;\n\n        &#x2F;&#x2F; å¦‚æœåªæä¾›äº†äº‹ä»¶ï¼Œåˆ™ç§»é™¤è¯¥äº‹ä»¶æ‰€æœ‰çš„ç›‘å¬å™¨\n        if (e &amp;&amp; !callback) &#123;\n            delete this._events[e]\n        &#125;\n\n        &#x2F;&#x2F; å¦‚æœåŒæ—¶æä¾›äº†äº‹ä»¶ä¸å›è°ƒï¼Œåˆ™åªç§»é™¤è¿™ä¸ªå›è°ƒçš„ç›‘å¬å™¨\n        if (e &amp;&amp; callback) &#123;\n            const &#123;callbacks&#125; &#x3D; this._events[e]\n            const index &#x3D; callbacks.findIndex(fn &#x3D;&gt; fn &#x3D;&#x3D;&#x3D; callback)\n            index &gt;&#x3D; 0 &amp;&amp; callbacks.splice(index, 1)\n        &#125;\n    &#125;\n&#125;\n\nä»¥ä¸ŠåŸºæœ¬ 1:1 æ¨¡æ‹Ÿäº† vue2 ä¸­çš„ EventBus  ï¼ˆpsï¼šç§»é™¤äº†æ•°ç»„ä¼ å‚çš„æ–¹å¼ï¼‰ï¼Œå°†å®ƒè®¾ä¸ºä¸€ä¸ªå…¨å±€å¯¹è±¡åå°±èƒ½å®ç°äº‹ä»¶çš„ç›‘å¬å’Œè§¦å‘ï¼Œä»è€Œå®ç°å…¨å±€é€šä¿¡ã€‚åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š\nconst emitter &#x3D; new DzEmitter()\n\nconst onClickFn &#x3D; data &#x3D;&gt; &#123;\n\tconsole.log(&#39;on-1&#39;, data);\n&#125;\nconst onClickFn2 &#x3D; data &#x3D;&gt; &#123;\n\tconsole.log(&#39;on-2&#39;, data);\n&#125;\nconst onceClickFn &#x3D; data &#x3D;&gt; &#123;\n\tconsole.log(&#39;once-1&#39;, data);\n&#125;\n\nemitter.on(&#39;onClick&#39;, onClickFn)\nemitter.on(&#39;onClick&#39;, onClickFn2)\nemitter.once(&#39;onceClick&#39;, onceClickFn)\n\n&#x2F;&#x2F; emitter.off(&#39;onClick&#39;, onClickFn2)\n&#x2F;&#x2F; emitter.off(&#39;onClick&#39;)\n\nsetTimeout(() &#x3D;&gt; &#123;\n    emitter.emit(&#39;onClick&#39;, &#96;è§¦å‘äº‹ä»¶ï¼šonClick&#96;)\n    emitter.emit(&#39;onceClick&#39;, &#96;è§¦å‘äº‹ä»¶ï¼šonceClick&#96;)\n    console.log(emitter);\n&#125;, 1000)\n\næ€»ç»“ä»¥ä¸Šä¾¿æ˜¯æˆ‘å°è¯•å†™ä¸€ä¸ª EventBus çš„å…¨éƒ¨äº†ï¼Œæ•´ä½“ä»£ç é‡è¿˜æ˜¯éå¸¸å°‘çš„ã€‚çŒœæµ‹ä¸€ä¸‹å°¤å¤§åœ¨ Vue3 ä¸­ç§»é™¤ EventBus çš„åŸå› ï¼Œå¯èƒ½æ˜¯å‡ºäºæ›´å¥½çš„æ€§èƒ½è€ƒè™‘å§ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸ºäº†æ›´è´´åˆ‡æˆ‘ä»¬æ—¥å¸¸çš„ç¼–ç¨‹ç›´è§‰å§ã€‚æ¯•ç«Ÿå®ç°ä¸€ä¸ªç®€å•çš„ EventBus éœ€è¦ç”Ÿæˆä¸€ä¸ªå¤æ‚çš„ Vue å®ä¾‹æ„Ÿè§‰ä¸æ˜¯å¤ªå¥½ï¼ˆpsï¼šä¸çº¯ç²¹ï¼Œä¼šæœ‰å¤ªå¤šä¸ç›¸å¹²çš„å±æ€§æ–¹æ³•ï¼‰ï¼Œå€ŸåŠ©äºä¸€äº›ä¸“æ³¨çš„åº“æ¥å®ç°è¿™ä¸ªåŠŸèƒ½åº”è¯¥ä¼šæ›´å¥½ã€‚ä»¥ä¸Šä»£ç ä»…ç”¨äºäº¤æµåˆ†äº«ï¼Œè¯·ä¸è¦ç”¨åœ¨å®é™…å¼€å‘ä¸­ï¼Œå‡ºäº†é—®é¢˜æœ¬äººæ¦‚ä¸è´Ÿè´£ğŸ¤£ğŸ¤£ã€‚ æƒ³è¦åœ¨ Vue3 ä¸­ä½¿ç”¨ EventBus åŠŸèƒ½çš„ï¼Œè¯·çœ‹å®ƒçš„ å®˜æ–¹æ¨è ã€‚\n","slug":"event-bus","date":"2021-12-23T07:47:51.000Z","categories_index":"","tags_index":"","author_index":"Aurora"},{"id":"c8af577eb1799cd38418c5cf4bc0ffdc","title":"PM2 deploy","content":"å‰è¨€Nuxt.js æ˜¯ä¸€ä¸ªåŸºäº Vue.js çš„è½»é‡çº§åº”ç”¨æ¡†æ¶,å¯ç”¨æ¥åˆ›å»ºæœåŠ¡ç«¯æ¸²æŸ“ (SSR) åº”ç”¨ï¼Œæœ¬ç¯‡æ¥è®²ä¸€ä¸‹ å¦‚ä½•ä½¿ç”¨ PM2 éƒ¨ç½² Nuxt åº”ç”¨ã€‚\nåˆ›å»º Nuxt åº”ç”¨å¯¹äºå¦‚ä½•åˆ›å»º Nuxt åº”ç”¨ï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ï¼Œè¿™é‡Œå»ºè®®ç›´æ¥å‚è€ƒ å®˜ç½‘ çš„åšæ³•ï¼Œä½¿ç”¨ create-nuxt-app å°±å¥½ï¼Œå¯ä»¥å‚ç…§ è¿™é‡Œ çš„è¯´æ˜æ¥äº†è§£åˆ›å»ºåº”ç”¨æ—¶çš„é…ç½®é€‰é¡¹ã€‚\nåˆ›å»ºæˆåŠŸåï¼ŒæŸ¥çœ‹ package.json æ–‡ä»¶ï¼Œå‘ç° Nuxt å·²å†…ç½®å¤šç§é¢„è®¾å‘½ä»¤ï¼š\n&#123;\n\t&quot;scripts&quot;: &#123;\n\t    &quot;dev&quot;: &quot;nuxt&quot;,\n\t    &quot;build&quot;: &quot;nuxt build&quot;,\n\t    &quot;start&quot;: &quot;nuxt start&quot;,\n\t    &quot;generate&quot;: &quot;nuxt generate&quot;,\n\t    &quot;lint:js&quot;: &quot;eslint --ext \\&quot;.js,.vue\\&quot; --ignore-path .gitignore .&quot;,\n\t    &quot;lint:style&quot;: &quot;stylelint \\&quot;**&#x2F;*.&#123;vue,css&#125;\\&quot; --ignore-path .gitignore&quot;,\n\t    &quot;prepare&quot;: &quot;husky install&quot;,\n\t    &quot;lint&quot;: &quot;yarn lint:js &amp;&amp; yarn lint:style&quot;\n\t&#125;\n&#125;\n\nè¿è¡Œ yarn build ä¼šæ‰“åŒ… nuxt åº”ç”¨å¹¶åœ¨æ ¹ç›®å½•ç”Ÿæˆ .nuxt ç›®å½•ï¼Œæ­¤æ—¶è¿è¡Œ yarn start å‘½ä»¤åè®¿é—® http://localhost:3000/ å³å¯æŸ¥çœ‹åº”ç”¨é¡µé¢ã€‚\nPM2-è¿›ç¨‹å®ˆæŠ¤äº†è§£ NodeJS çš„äººéƒ½çŸ¥é“ï¼Œé€šè¿‡ CMD/PowerShell å¼€å¯çš„ Node æœåŠ¡ï¼Œåœ¨å…³é—­ å‘½ä»¤æç¤ºç¬¦ çª—å£åï¼ŒæœåŠ¡å°±æ–­å¼€äº†ï¼Œé¡µé¢ä¹Ÿå°±è®¿é—®ä¸äº†ã€‚é‚£ä¹ˆè¿™å¦‚ä½•è§£å†³å‘¢ï¼Ÿè§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ PM2ï¼š\n\n\n\n\n\n\n\n\n\nPM2 æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ç®¡ç†å™¨ï¼Œå®ƒå°†å¸®åŠ©æ‚¨ç®¡ç†å’Œä¿æŒæ‚¨çš„åº”ç”¨ç¨‹åºåœ¨çº¿ã€‚\nnpm install pm2@latest -g\n# or\nyarn global add pm2\n\nè¿è¡Œä¸Šè¿°å‘½ä»¤å®Œæˆ pm2 çš„å®‰è£…ï¼Œæ¥ä¸‹æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª ecosystem.config.js æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nmodule.exports &#x3D; &#123;\n  apps: [\n    &#123;\n      name: &#39;NuxtAppName&#39;,\n      exec_mode: &#39;cluster&#39;,\n      instances: &#39;max&#39;, &#x2F;&#x2F; Or a number of instances\n      script: &#39;.&#x2F;node_modules&#x2F;nuxt&#x2F;bin&#x2F;nuxt.js&#39;,\n      args: &#39;start&#39;\n    &#125;\n  ]\n&#125;\n\nå¥½äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿è¡Œ pm2 start åï¼Œä½ å¯ä»¥å°†ä»»ä½• å‘½ä»¤æç¤ºç¬¦ çª—å£å…³æ‰éƒ½å¯ä»¥è®¿é—® http://localhost:3000/ æŸ¥çœ‹åˆ°åº”ç”¨é¡µé¢ï¼Œåªè¦ä½ ä¸é‡å¯ç”µè„‘ã€‚\npm2-windows-startup-æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨æ¢å¤ pm2 è¿›ç¨‹ä¾æ®ä¸Šè¿°å†…å®¹ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç”µè„‘æˆ–æœåŠ¡å™¨é‡å¯åï¼Œåº”ç”¨è®¿é—®ä¸äº†æ€ä¹ˆåŠï¼Ÿå®é™…çš„ç”Ÿäº§æœåŠ¡å™¨ä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šåº”ç”¨æœåŠ¡åŒæ—¶è¿è¡Œï¼Œæ€»ä¸èƒ½æœåŠ¡å™¨å®•æœºé‡å¯åä¸€ä¸€æ‰‹åŠ¨æ•²å‘½ä»¤é‡å¯æœåŠ¡å§ã€‚è¿™é‡Œæˆ‘ä»¬è‚¯å®šæƒ³è¦åœ¨æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨æ¢å¤åº”ç”¨æœåŠ¡ï¼ˆåœ¨ windows ç³»ç»Ÿä¸­å®è·µä¸‹ï¼‰ï¼Œé‚£ä¹ˆäº†è§£ä¸€ä¸‹ pm2-windows-startup ï¼š\nå®‰è£…npm install pm2-windows-startup -g\n# or\nyarn global add pm2-windows-startup\n\næ·»åŠ æ³¨å†Œè¡¨é¡¹pm2-startup install\n\næ³¨æ„ï¼šç¬¬ä¸€æ¬¡å®‰è£…æˆ–é‡å¯æ—¶å¯èƒ½ä¼šè¢«æ€æ¯’è½¯ä»¶è­¦å‘Šï¼Œå…è®¸å³å¯ã€‚\nä¿å­˜å½“å‰çš„è¿›ç¨‹åˆ—è¡¨åœ¨ä½¿ç”¨ pm2 start å¯åŠ¨æœåŠ¡åï¼Œä½¿ç”¨ pm2 save å³å¯ä¿å­˜å½“å‰çš„è¿›ç¨‹åˆ—è¡¨ã€‚åœ¨é‡å¯ç”µè„‘åè®¿é—® http://localhost:3000/ ä¾ç„¶å¯ä»¥çœ‹åˆ°åº”ç”¨é¡µé¢ã€‚\nå‚è€ƒ\nNuxt å®˜ç½‘ - ä½¿ç”¨ PM2 éƒ¨ç½² Nuxt \npm2-windows-startup - npm \nnuxt.jséƒ¨ç½²vueåº”ç”¨åˆ°æœåŠ¡ç«¯è¿‡ç¨‹ \nPM2 å®˜ç½‘ \n\næºç æ›´å¤šç»†èŠ‚å‚è€ƒ æºç \n","slug":"pm2-deploy","date":"2021-12-23T07:47:51.000Z","categories_index":"","tags_index":"","author_index":"Aurora"}]